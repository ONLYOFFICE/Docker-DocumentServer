name: "Run Database List"

on:
  push:
  schedule:
    - cron: '0 21 * * 6'

jobs:
  start_files_1:
    name: "Databases: ${{ matrix.compose_file }}:${{matrix.version}}"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        compose_file: [postgres.yml]
        version: ["version=9.5", "version=9", "version=10", "version=11", "version=12"]
        include:
          - compose_file: activemq.yml
            version: "version=latest"                 # latest version activemq
          - compose_file: activemq.yml
            version: "version=5.14.3"                 # activemq 5.14.3
          - compose_file: rabbitmq.yml
            version: "version=latest"                 # rabbitmq latest
          - compose_file: rabbitmq.yml
            version: "version=3"                      # rabbitmq 3
          - compose_file: redis.yml
            version: "version=5"                      # redis 5
          - compose_file: redis.yml
            version: "version=6"                      # redis 6
          - compose_file: graphite.yml
            version: "version=latest"                 # graphite latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: "Databases: ${{ matrix.compose_file }}:${{matrix.version}}"
        run: |
          cd tests
          # Export .yml files in variable config
          export config=${{ matrix.compose_file }} 
          # Sending version number in variable POSTGRES_VERSION
          for version in "${{ matrix.version }}"; do
            export POSTGRES_VERSION=${version#*=}                           # Deleting all symbols before version number
          done
          # Sending version number in variable ACTIVEMQ_VERSION
          for activemq_version in "${{ matrix.version }}"; do
               export ACTIVEMQ_VERSION=${activemq_version#*=}               # Deleting all symbols before version number
          done
          # Sending version number in variable RABBITMQ_VERSION
          for rabbitmq_version in "${{ matrix.version }}"; do
               export RABBITMQ_VERSION=${rabbitmq_version#*=}               # Deleting all symbols before version number
          done
          # Sending version number in variable REDIS_VERSION
          for redis_version in "${{ matrix.version }}"; do
               export REDIS_VERSION=${redis_version#*=}                     # Deleting all symbols before version number
          done
          # Sending version number in variable MYSQL_VERSION       
          for mysql_version in "${{ matrix.version }}"; do
            export MYSQL_VERSION=${mysql_version#*=}                        # Deleting all symbols before version number
          done
          # Sending version number in variable MARIADB_VERSION               
          for mariadb_version in "${{ matrix.version }}"; do
              export MARIADB_VERSION=${mariadb_version#*=}                  # Deleting all symbols before version number
          done
          chmod +x test.sh
          bash test.sh

  start_files_2:
    name: "Cert files: ${{ matrix.cert_file }}"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        compose_file: [ certs.yml, certs-customized.yml, standalone.yml ]

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: "Cert files: ${{ matrix.compose_file }}:${{matrix.version}}"
        run: |
          cd tests
          # Export .yml files in variable config
          export config=${{ matrix.compose_file }} 
          chmod +x test.sh
          bash test.sh
      
        
