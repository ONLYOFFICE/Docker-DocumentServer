name: "Run Database List"

on:
  push:
  schedule:
    - cron: '0 21 * * 6'

jobs:
  start_databases_and_certs:
    name: "File: ${{ matrix.name }}"
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - compose_file: postgres.yml
            version: "POSTGRES_VERSION=9.5"                           # postgtres 9.5 version
            name: "Test postgres 9.5 file"

          - compose_file: postgres.yml
            version: "POSTGRES_VERSION=9"                             # postgtres 9 version
            name: "Test postgres 9 file"

          - compose_file: postgres.yml
            version: "POSTGRES_VERSION=10"                            # postgtres 10 version
            name: "Test postgres 10 file"

          - compose_file: postgres.yml
            version: "POSTGRES_VERSION=11"                            # postgtres 11 version
            name: "Test postgres 11 file"

          - compose_file: postgres.yml
            version: "POSTGRES_VERSION=12"                            # postgtres 12 version
            name: "Test postgres 12 file"

          - compose_file: activemq.yml
            version: "ACTIVEMQ_VERSION=latest"                        # latest version activemq
            name: "Test activemq latest file"

          - compose_file: activemq.yml
            version: "ACTIVEMQ_VERSION=5.14.3"                        # activemq 5.14.3
            name: "Test activemq 5.14.3 file"

          - compose_file: rabbitmq.yml
            version: "RABBITMQ_VERSION=latest"                        # rabbitmq latest
            name: "Test rabbitmq latest file"

          - compose_file: rabbitmq.yml
            version: "RABBITMQ_VERSION=3"                             # rabbitmq 3
            name: "Test rabbitmq 3 file"

          - compose_file: redis.yml
            version: "REDIS_VERSION=5"                                # redis 5
            name: "Test redis 5 file"

          - compose_file: redis.yml
            version: "REDIS_VERSION=6"                                # redis 6
            name: "Test redis 6 file"

          - compose_file: graphite.yml
            version: "GRAPHITE_VERSION=latest"                        # graphite latest
            name: "Test graphite latest file"

          - compose_file: mysql.yml
            version: "MYSQL_VERSION=5"                                # mysql 5
            name: "Test mysql 5 file"

          - compose_file: mysql.yml
            version: "MYSQL_VERSION=8"                                # mysql 8
            name: "Test mysql 8 file"

          - compose_file: mysql.yml
            version: "MYSQL_VERSION=5.7"                              # mysql 5.7
            name: "Test mysql 5.7 file"

          - compose_file: mariadb.yml
            version: "MARIADB_VERSION=10"                             # mariadb 10
            name: "Test mariadb 10 file"

          - compose_file: mariadb.yml
            version: "MARIADB_VERSION=10.5"                           # mariadb 10.5
            name: "Test mariadb 10.5 file"

          - compose_file: certs.yml
            name: "Start certs file"

          - compose_file: certs-customized.yml
            name: "Start certs-customized file"

          - compose_file: standalone.yml
            name: "Start standalone file"

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: "Start ${{ matrix.name }}"
        run: |
          cd tests
          # Export .yml files in variable config
          export config=${{ matrix.compose_file }} 
          echo "export versions for ${{ matrix.compose_file }}"
          for v in ${{ matrix.version }}; do
            export ${v}
          done
          chmod +x test.sh
          bash test.sh
          echo config file is ${config}
          echo postgresql version is ${POSTGRESQL_VERSION}
          echo mysql version is ${MYSQL_VERSION}
          echo rabbitmq version is ${RABBITMQ_VERSION}